<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A review of health outcome trends before and after Hurricane Harvey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="ClaireGutermuthFinalProject_files/libs/clipboard/clipboard.min.js"></script>
<script src="ClaireGutermuthFinalProject_files/libs/quarto-html/quarto.js"></script>
<script src="ClaireGutermuthFinalProject_files/libs/quarto-html/popper.min.js"></script>
<script src="ClaireGutermuthFinalProject_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ClaireGutermuthFinalProject_files/libs/quarto-html/anchor.min.js"></script>
<link href="ClaireGutermuthFinalProject_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ClaireGutermuthFinalProject_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ClaireGutermuthFinalProject_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ClaireGutermuthFinalProject_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ClaireGutermuthFinalProject_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A review of health outcome trends before and after Hurricane Harvey</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>By Claire Gutermuth</p>
<p>December 20, 2024</p>
<p>On the evening of August 25th, 2017, Hurricane Harvey made its first landfall in the United States along the Texas coast. Over the next five days, the Category 4 storm slowed to a near halt while it continued to dump torrential rains over the greater Houston metropolitan area, the country’s fourth most populous city. What would ensue was one of the most destructive natural disasters in United States history.</p>
<p><a href="https://jamanetwork.com/journals/jama/fullarticle/2654052">According to some estimates</a>, more than 33 trillion gallons of water were released onto Texas and Louisiana over the course of those five days, resulting in record-breaking rainfall of 56 inches in some places. At least 13 million people were directly affected by the storm, while tens of thousands were rescued from flood waters, and over 100 died. Just days after landfall, thousands of homes had been destroyed, with over <a href="https://apnews.com/article/us-news-ap-top-news-burlington-houston-north-america-44af0775d467489f97ab0cdc5baad737">17,000 sustaining major damage</a>. At an estimated cost of $125 billion dollars in damages, Hurricane Harvey ties Hurricane Katrina as the costliest natural disaster the country has ever seen.</p>
<p>After a natural disaster, is it common for population health conditions to worsen. This is particularly true of mental health: <a href="https://pubmed.ncbi.nlm.nih.gov/15462535/">one study</a> found that rates of post-traumatic stress disorder were high amongst victims of an extreme flood in Tobasco, Mexico, in 1999. One of the most affected areas, Tezuitlán, which experienced mass casualties and displacement, had a prevalence of nearly 50% six months after the disaster occurred. <a href="https://jamanetwork.com/journals/jama/fullarticle/2654052">Another analysis of mental health after hurricanes</a> showed that up to half of survivors who were directly in the storm’s path risked developing post-traumatic stress disorder, echoing these findings.</p>
<p>Natural disasters can also exacerbate existing health conditions: <a href="https://journals.sagepub.com/doi/pdf/10.1177/0033354920930133">one survey of the disparities in health effects</a> post-Hurricane Harvey found that those who evacuated had 36% greater odds of reporting more than one physical health problem for each additional adverse event they experienced (e.g., loss of irreplaceable items, being separated from family members, or being in dangerous or unsafe situations). Disasters may also create environmental hazards, which in turn have an impact on population health. A major concern specific to Houston is the increase in exposure to biohazards: with each hurricane, pollutants and trash mix with floodwaters that rise from the bayous that rove throughout the city. It is estimated that Harvey created a <a href="https://www.cambridge.org/core/journals/disaster-medicine-and-public-health-preparedness/article/abs/spatial-and-temporal-investigation-of-medical-surge-in-dallasfort-worth-during-hurricane-harvey-texas-2017/A0E8522392302BFCF79ECBF1DC444859">whopping 6 million cubic meters</a> of garbage within Houston city limits alone, much of it intermingling in the flood and exposing its citizens to toxic levels of chemicals they may not have encountered otherwise.</p>
<p>Extreme disasters are costly on a healthcare system as well: <a href="https://www.cdc.gov/nssp/php/story/data-shows-ed-surge-after-hurricane-harvey.html">according to the Center for Disease Control</a>, in the weeks following Harvey, at least 10 hospitals experienced a 600% ED visit surge from evacuees, two of which experienced a greater than 1,000% surge. In response to Harvey’s strain on the health system, the U.S. Department of Health and Human Services’ Administration for Strategic Preparedness and Response published a <a href="https://aspr.hhs.gov/HealthCareReadiness/Recovery/Documents/TX-HC-Recovery-Guide-10July2018.pdf">2018 Healthcare System Recovery Guide</a> recommending that hospital systems “prepare to utilize all financial assistance avenues available” and “identify contingency arrangements, contracts, and relationships with financial institutions to extend lines of credit for longer periods post-disaster.”</p>
<p>Though the negative impact of these natural disasters on human health is well-documented, much of the available literature either focuses on the acute effects directly after the storm, or regards a specific population or disease. There is little comparison of incidence rates between disparate conditions, particularly for the general population.</p>
<p>The analysis below outlines the change in several health measures from 2017 to 2018 for the areas in Houston most affected by Hurricane Harvey. The hardest hit areas were defined as the 20 zip codes with the <a href="https://www.khou.com/article/weather/harvey/report-highlights-top-20-areas-hit-hardest-by-hurricane-harvey/285-493668432">highest number of FEMA applications</a> for individual assistance as of November 21, 2017. The list was culled down to 14 zip codes based on available health measure data from the Center for Disease Control’s 500 Cities and Places data. The graph represents the change in crude prevalence for various health measures from 2017 to 2018 aggregated across zip codes.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClaireGutermuthFinalProject_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>According to this graph, nearly every measure was impacted negatively from one year to the next: generally speaking, prevalence of most health conditions increased, while use of preventive services decreased. The most striking difference between years is the prevalence of 65+ individuals who are up-to-date on a core set of clinical preventive services, including having had a flu shot in the past year, having had a PPV shot ever, and having had a colorectal cancer screening in the last 2 years. These relatively large decreases are more pronounced for women (down 8.6%) than men (down 6.3%).</p>
<p>Changes in healthcare utilization after hurricanes are not uncommon: patients frequently delay, reduce, or terminate treatments due to cost, inconvenience, or lack of access. Care itself may be restricted depending on damages to the area, causing patients to switch to telehealth or to use less-affected facilities. One <a href="https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2786997">longitudinal study</a> regarding healthcare utilization for survivors of Hurricane Harvey documented significant declines in visits to primary care providers (PCP) amongst veterans – in some cases, a radical decrease of nearly a half. These declines persisted well after two months post-hurricane and were greatly lower than projections of PCP utilization outlined by the study authors. In this study, a total 22.4% of respondents reported going without access to health care during or soon after Harvey. Given that adults over 65 are a particularly vulnerable group, especially in the context of natural disasters, it is plausible that the decrease in preventive care was accelerated by the hurricane.</p>
<p>Perhaps somewhat intuitively, conditions such as obesity, short sleep duration, diabetes, and high cholesterol had relatively larger increases in prevalence compared to other, less lifestyle-related diseases, including kidney disease and non-melanoma cancer. This echoes findings from an article regarding <a href="https://watermark.silverchair.com/mattei_2022_oi_211123_1641393919.80835.pdf?token=AQECAHi208BE49Ooan9kkhW_Ercy7Dm3ZL_9Cf3qfKAc485ysgAAA0QwggNABgkqhkiG9w0BBwagggMxMIIDLQIBADCCAyYGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMp9vBPoTEaUyqfajEAgEQgIIC9w4GoHZ4w0U6iikQz-Ja-JP3w3PLkrTc2ZZvDgtehNyNxD11O8bcB-Zuo4NiV5y1BdbV47Bp4WonSWPhw3ctncJKyvqwaRYUyT7nucae906XXqGfCZK-4gbej81xJ0zXe0NXs9yBbMnnmI1Z12JGDgxjCFGDAZS2d0i5czzWjlnuZivHjE0vVmrBHO-lLrvWBPZMEORji1LpkyhAEyjzuKGjMwNMIsPTgzbnQQAmKoJgrFPxux1Ol4a6Of6gQH3R0Hd1khRoKryZ0Zw_VS2cRROOJtday_sR7U6JqUxCSibeEFbJBK4mxqWrWAfXuOq_g-AcO9Y7YEx8xfAwJ8dE1Iohpfx7F91IDeSiFF5pO2AJPLegrAsrGoolUetGKrpNeVUI5k8uUbLC-cNDdd5Fn2xBXe8KU0SygmCIf_oCm2p6_vcez9GCZjpuPsE1XB5psFOttamTMSIaaX-qN4mx7xiBP0P6UhrWSI3RQLTv0Lv-PY3JPcKnIuSOP_6dkbMKcqj6CywH4cr8pR3c3fbavy7Ai9_uIXHqYeefY4wuiHLtTwNEqFXr2NLO5Ot9dAw8iwRbwDeOGr8851v5YI58oqWBbttLxjRg5x1AcN83fjgZuSSOgSbUgcAfx4vx_xMqU4623qQ3Tj94YpCr2iZatQnRRDvqutA0S2fr1bLywrYM7crS2vXmUrzSml1Iyh_qDUObZaiOym9BHmWHDppSbggpp7FQ8J7vLcHgJB24-j5-2MhCOS5J8Ey--gWJox0mrhmTApVHt83DbEnr2YwIRr-kFuE4ZNr5PDuo2puG-F4Aka-qmC1FMcMyWthRmO5gvU61MyU76GrjU4OdrqWAj__XeGbzEAWaFw8nkMJXdC44el3c51TM3rToCdJCIVAj7zr_DBIRiKINSZeiYdvC8inti1tdLobWsn2TjTRSuxQzEaLBhVpNqVUQxCjIKozPTMRGNW_Sj2_wHJHZJcyYPaTWFU4jfhY6-JqXFgqoi6pcGzkqrQKjFQ">chronic diseases and associated risk factors among adults in Puerto Rico after Hurricane Maria</a>. Comparing health measures collected in 2015 and again in 2019, researchers found significant increases in sedentarism, obesity, hypertension, arthritis, and high cholesterol after the hurricane, suggesting that the hurricane negatively impacted supportive health and lifestyle factors. This study also found a significant decrease in yearly influenza vaccination rates.</p>
<p>It is also worth underscoring that across the zip codes most affected by Hurricane Harvey, the prevalence of those 18 years or older without health insurance decreased by 2.5%. Though there is little available data on the direct effect natural disasters may have on health insurance rates, one thing is for sure: lack of health insurance is consistently associated with poorer health. One <a href="https://journals.sagepub.com/doi/pdf/10.1177/00333549221148169">analysis of factors associated with poor health outcomes among Vietnamese Americans after Hurricane Harvey</a> reported that survey respondents with health insurance had 75% lower odds of reporting poor physical health post-storm compared to participants without health insurance. The most plausible explanation is that insured individuals are more likely to seek care after the onset of symptoms, while those who are uninsured may choose to delay because of cost.</p>
<p>This next graph represents changes in prevalence of preventive care and access to health insurance on a more granular level. Zip codes are ranked from left to right in order of most applications to least.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClaireGutermuthFinalProject_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here we see that the hardest-hit zip codes tended to experience the most drastic decreases in preventive care, as well as the most drastic increases in lack of insured individuals before and after the hurricane. The zip code with the largest average decrease in preventive services for older adults, as well as the largest increase in individuals without health insurance, was 77044. Based in Northwest Houston, this area encompasses not one, but two bayous, and according to the <a href="https://trerc.tamu.edu/article/imperfect-storm/">Texas Real Estate Research Center</a>, 48% of the homes in this area were damaged by the storm. While residents in this area earn an average of $73,589 per year, much higher than the median income level of $53,657, every single other one of the top-ten most damaged zip codes earned well below the median income, adding to the devastation of the storm.</p>
<p>An additional data cut further demonstrates the changes in preventive care and access to health insurance within Houston:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClaireGutermuthFinalProject_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClaireGutermuthFinalProject_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The right of each graph is markedly darker than the left, demonstrating an increase in prevalence across zip codes. The starkest differences come from 77044 for both elderly women’s use of preventive services and access to health insurance, likely driving the averages up when the data is aggregated overall.</p>
<p>A final chart highlights the change in these measures over time:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClaireGutermuthFinalProject_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From 2017 to 2018, the number of uninsured individuals has a consistent downward trend. According to the 2024 release of the <a href="https://www2.census.gov/library/publications/2024/demo/acsbr-021.pdf">American Community Survey</a> run by the U.S. Census Bureau, 21.7% of Texas adults age 19 to 64 went without health insurance in 2023. This makes Texas the worst-ranked state in the nation with regards to number of adults uninsured, and in fact, the rate is nearly double the nation’s average of 11%. One reason for this is Texas’ continued refusal to expand Medicaid. The state is one of ten in the nation that has not implemented the expansion, a measure that would allow an estimated 1.4 million currently uninsured workers to have access to health insurance. According to the Texas Medical Association, the uninsured are up to four times less likely to have regular health care and are more likely to die from health-related problems. They estimate that extending healthcare coverage could improve the overall health of the uninsured by 7 to 8%.</p>
<p>The graph also reveals a marked rebound in the prevalence of both women and men over 65 who had received preventive care (there is no change between 2018 and 2019 because this health measure was only collected every two years until 2018, when the data started being collected yearly.) This trend could be indicative of resilience, which would be welcome news. Unfortunately, it is beyond the limits of this analysis to ascertain the true reasons for these changes. It is worth noting that while these graphs provide an overview of directional changes in health and social vulnerability before and after Hurricane Harvey, they are not indicative of a causal effect.</p>
<p>Most importantly, due to limitations in the information available, these analyses do not control for demographic or socioeconomic factors, many of which are known to affect health outcomes. For example, according to a <a href="https://www.nytimes.com/2018/09/03/us/hurricane-harvey-houston.html">New York Times article</a>, surveys conducted in August of 2018 revealed that of those with badly damaged homes, 27% of Hispanic individuals reported that their homes still remained unsafe to live in a year later, significantly more than the 20% of Black individuals and 11% of White individuals in the same situation. Another <a href="https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2786997">analysis of healthcare utilization</a> among veterans before and after Harvey aptly notes: “changes in health status and health care utilization following disasters are not universal in populations exposed to hurricanes or flooding…the presence, magnitude, and duration of negative outcomes following disasters are often highly conditioned on race and ethnicity and socioeconomic status. Indeed, differential social vulnerabilities before flooding or other disaster exposures frequently exacerbate and accelerate differential trajectories following disasters.”</p>
<p>It is also true that outside of demographic and social variables, there may be other factors at play. In 2019, the <a href="https://www.houstonhealth.org/media/5626/download">Houston Area Agency for Aging</a> from the Houston Health Department proposed a robust plan to increase healthcare access for seniors, focusing on preventive care. It is possible that the seeming resilience in this measure over more recent years has in part to do with increased government funding or strengthened outreach programs such as this one.</p>
<p>I point this out not to diminish the analysis above, but to demonstrate how little we know about the true effects of natural disasters. The current literature justifiably focuses on the immediate effects of hurricanes where there is the most dire need; longer-spanning studies often focus on more specified, rather than general, populations and conditions due to resource constraints. Some of the most reliable broader population health data comes from the Census and the Center for Disease Control, the collection and publishing of which has years in lead time. Furthermore, when a hurricane hits, data collection is likely the last thing on any sane person’s mind.</p>
<p>Nevertheless, a decision is only as good as the data that informs it, and there is a dearth of information on longitudinal health outcomes after hurricanes to help shape disaster relief policy. Harvey is one example of the astounding devastation that these events can incur. How many more will we need before we start collecting the necessary data to plan in advance?</p>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>